<!DOCTYPE html>
<html lang="en">
<head>
    <title>FLEX-IT-OUT PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        /* Updated responsive styles */
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #3d0000);
            color: white;
            min-height: 100vh;
            overflow: auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        video, canvas {
            width: 100%;
            max-width: 960px;
            border: 2px solid #ff1e1e;
            border-radius: 10px;
        }

        /* Auth modal */
        .auth-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 2rem;
            border-radius: 10px;
            z-index: 1000;
        }

        /* Leaderboard styles */
        .leaderboard {
            background: rgba(0,0,0,0.7);
            padding: 1rem;
            border-radius: 10px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            video, canvas {
                height: auto;
            }
        }
    </style>
</head>
<body>
     <!-- Auth Modal -->
    <div id="authModal" class="auth-modal" style="display: none;">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <button onclick="signup()">Sign Up</button>
    </div>

    <div class="container">
        <div id="app">
            <h1>üí™ FLEX-IT-OUT PRO</h1>
            <div id="userInfo"></div>
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            <!-- Existing tracking UI... -->
        </div>

        <!-- Leaderboard Panel -->
        <div class="leaderboard">
            <h2>üèÜ Leaderboard</h2>
            <div id="globalLeaderboard"></div>
            <h3>Current Challenges</h3>
            <div id="challenges"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
    apiKey: "AIzaSyAyERSnYLNIgpsVpl8McFOudoxHBc9OQfg",
    authDomain: "workout-a0bbc.firebaseapp.com",
    projectId: "workout-a0bbc",
    storageBucket: "workout-a0bbc.firebasestorage.app",
    messagingSenderId: "219997301194",
    appId: "1:219997301194:web:79bc45bb47deb563fd4733"
  };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const app = initializeApp(firebaseConfig);

        // Auth Functions
        let currentUser = null;
        
        function toggleAuthModal() {
            const modal = document.getElementById('authModal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                console.error("Login error:", error);
            }
        }

        async function signup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const { user } = await auth.createUserWithEmailAndPassword(email, password);
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    stats: { squats: 0, pushups: 0 }
                });
            } catch (error) {
                console.error("Signup error:", error);
            }
        }

        // User Profile Management
        function updateProfile(updates) {
            if (!currentUser) return;
            return db.collection('users').doc(currentUser.uid).update(updates);
        }

        // Leaderboard Functions
        async function updateLeaderboard() {
            const snapshot = await db.collection('users')
                .orderBy('stats.squats', 'desc')
                .limit(10)
                .get();
            
            const leaderboardHtml = snapshot.docs.map(doc => 
                `<div>${doc.data().email}: ${doc.data().stats.squats} squats</div>`
            ).join('');
            document.getElementById('globalLeaderboard').innerHTML = leaderboardHtml;
        }

        // Challenge System
        async function loadChallenges() {
            const snapshot = await db.collection('challenges')
                .where('endDate', '>', new Date())
                .get();
            
            const challengesHtml = snapshot.docs.map(doc => {
                const data = doc.data();
                return `<div class="challenge">
                    <h4>${data.title}</h4>
                    <p>${data.description}</p>
                    <p>Prize: ${data.prize}</p>
                </div>`;
            }).join('');
            document.getElementById('challenges').innerHTML = challengesHtml;
        }

        // Modified STATE object to track workout sessions
        const STATE = {
            currentSession: {
                squats: 0,
                pushups: 0,
                startTime: null,
                calories: 0
            },
            // ... existing state properties
        };

        // Modified updateReps to sync with Firebase
        async function updateReps() {
            // ... existing update code
            if (currentUser) {
                await db.collection('users').doc(currentUser.uid).update({
                    'stats.squats': firebase.firestore.FieldValue.increment(STATE.squatReps),
                    'stats.pushups': firebase.firestore.FieldValue.increment(STATE.pushupReps)
                });
                updateLeaderboard();
            }
        }

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                document.getElementById('authModal').style.display = 'none';
                document.getElementById('userInfo').innerHTML = `
                    Welcome, ${user.email}!
                    <button onclick="auth.signOut()">Logout</button>
                `;
                updateLeaderboard();
                loadChallenges();
            } else {
                toggleAuthModal();
            }
        });

        // Multi-Device Camera Setup
        async function setupCamera() {
            const video = document.getElementById('video');
            const constraints = {
                video: { 
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    facingMode: 'environment' 
                }
            };
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                return new Promise(resolve => {
                    video.onloadedmetadata = () => resolve(video);
                });
            } catch (error) {
                console.error("Camera error:", error);
            }
        }

        // Initialize after auth
        auth.onAuthStateChanged(async user => {
            if (user) {
                await setupCamera();
                // Existing pose initialization...
            }
        });
    </script>
</body>
</html>